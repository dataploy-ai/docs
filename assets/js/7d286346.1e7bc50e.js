"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8716],{3905:function(t,e,a){a.d(e,{Zo:function(){return o},kt:function(){return k}});var n=a(7294);function l(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function r(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function i(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?r(Object(a),!0).forEach((function(e){l(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function u(t,e){if(null==t)return{};var a,n,l=function(t,e){if(null==t)return{};var a,n,l={},r=Object.keys(t);for(n=0;n<r.length;n++)a=r[n],e.indexOf(a)>=0||(l[a]=t[a]);return l}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(n=0;n<r.length;n++)a=r[n],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(l[a]=t[a])}return l}var d=n.createContext({}),p=function(t){var e=n.useContext(d),a=e;return t&&(a="function"==typeof t?t(e):i(i({},e),t)),a},o=function(t){var e=p(t.components);return n.createElement(d.Provider,{value:e},t.children)},m={inlineCode:"code",wrapper:function(t){var e=t.children;return n.createElement(n.Fragment,{},e)}},s=n.forwardRef((function(t,e){var a=t.components,l=t.mdxType,r=t.originalType,d=t.parentName,o=u(t,["components","mdxType","originalType","parentName"]),s=p(a),k=l,g=s["".concat(d,".").concat(k)]||s[k]||m[k]||r;return a?n.createElement(g,i(i({ref:e},o),{},{components:a})):n.createElement(g,i({ref:e},o))}));function k(t,e){var a=arguments,l=e&&e.mdxType;if("string"==typeof t||l){var r=a.length,i=new Array(r);i[0]=s;var u={};for(var d in e)hasOwnProperty.call(e,d)&&(u[d]=e[d]);u.originalType=t,u.mdxType="string"==typeof t?t:l,i[1]=u;for(var p=2;p<r;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}s.displayName="MDXCreateElement"},4957:function(t,e,a){a.r(e),a.d(e,{assets:function(){return o},contentTitle:function(){return d},default:function(){return k},frontMatter:function(){return u},metadata:function(){return p},toc:function(){return m}});var n=a(7462),l=a(3366),r=(a(7294),a(3905)),i=["components"],u={},d=void 0,p={unversionedId:"getting-started-with-labsdk",id:"getting-started-with-labsdk",title:"getting-started-with-labsdk",description:"Open In Colab",source:"@site/docs/getting-started-with-labsdk.md",sourceDirName:".",slug:"/getting-started-with-labsdk",permalink:"/docs/getting-started-with-labsdk",draft:!1,editUrl:"https://github.com/natun-ai/docs/tree/master/docs/getting-started-with-labsdk.md",tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Contact the support team",permalink:"/docs/contact-the-support-team"}},o={},m=[{value:"Intalling the SDK \xb6",id:"intalling-the-sdk-",level:2},{value:"Writing our first features \xb6",id:"writing-our-first-features-",level:2},{value:"Historical Replay \xb6",id:"historical-replay-",level:2},{value:"&gt; #### \u2139\ufe0f Looking to run Replay at scale? try Natun Enterprise \ud83e\uddb8\u200d\u2642\ufe0f \xb6",id:"--\u2139\ufe0f-looking-to-run-replay-at-scale-try-natun-enterprise-\ufe0f-",level:2},{value:"Building our model \xb6",id:"building-our-model-",level:2},{value:"Deployment \xb6",id:"deployment-",level:2},{value:"Manifest deployment (only use this for production) \xb6",id:"manifest-deployment-only-use-this-for-production-",level:3},{value:"Direct deployment (useful for local development) \xb6",id:"direct-deployment-useful-for-local-development-",level:3},{value:"Viola! \ud83e\ude84 \xb6",id:"viola--",level:2}],s={toc:m};function k(t){var e=t.components,a=(0,l.Z)(t,i);return(0,r.kt)("wrapper",(0,n.Z)({},s,a,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://colab.research.google.com/github/natun-ai/docs/blob/master/docs/getting-started-with-labsdk.ipynb"},(0,r.kt)("img",{parentName:"a",src:"https://colab.research.google.com/assets/colab-badge.svg",alt:"Open In Colab"}))),(0,r.kt)("h1",{id:"natun-labsdk-"},"Natun LabSDK ",(0,r.kt)("a",{parentName:"h1",href:"#Natun-LabSDK"},"\xb6")),(0,r.kt)("p",null,"We recommend starting with Natun using the LabSDK, which helping creating and to build production-grade features while developing your model."),(0,r.kt)("h2",{id:"intalling-the-sdk-"},"Intalling the SDK ",(0,r.kt)("a",{parentName:"h2",href:"#Intalling-the-SDK"},"\xb6")),(0,r.kt)("p",null,"Yalla, let's go! The next two blocks install the LabSDK and imports it."),(0,r.kt)("p",null,"In\xa0","[","\xa0","]",":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"!pip install --upgrade natun-labsdk\n\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\nRequirement already satisfied: natun-labsdk in /usr/local/lib/python3.7/dist-packages (0.0.2a2)\nRequirement already satisfied: pandas in /usr/local/lib/python3.7/dist-packages (from natun-labsdk) (1.3.5)\nRequirement already satisfied: python-dateutil>=2.7.3 in /usr/local/lib/python3.7/dist-packages (from pandas->natun-labsdk) (2.8.2)\nRequirement already satisfied: numpy>=1.17.3 in /usr/local/lib/python3.7/dist-packages (from pandas->natun-labsdk) (1.21.6)\nRequirement already satisfied: pytz>=2017.3 in /usr/local/lib/python3.7/dist-packages (from pandas->natun-labsdk) (2022.1)\nRequirement already satisfied: six>=1.5 in /usr/local/lib/python3.7/dist-packages (from python-dateutil>=2.7.3->pandas->natun-labsdk) (1.15.0)\n\n")),(0,r.kt)("p",null,"In\xa0","[","\xa0","]",":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"import natun\nfrom natun.stub import *  #<-- this is prevent the IDE/Notebookfrom detecting PyExp built-in as errors\n\n")),(0,r.kt)("h2",{id:"writing-our-first-features-"},"Writing our first features ",(0,r.kt)("a",{parentName:"h2",href:"#Writing-our-first-features"},"\xb6")),(0,r.kt)("p",null,"Our first feature is calculating how many emails an account got over the last 10 hours using the ",(0,r.kt)("inlineCode",{parentName:"p"},"streaming")," builder."),(0,r.kt)("p",null,"It uses the ",(0,r.kt)("inlineCode",{parentName:"p"},"clickstream")," data-connector the DevOps configured for us."),(0,r.kt)("p",null,"In\xa0","[","\xa0","]",":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'@natun.register(str, freshness=\'1m\', staleness=\'10h\', options={})\n@natun.connector("emails")  #<-- wher\'e decorating our feature with our production data-connector! \ud83d\ude0e\n@natun.builder("streaming")\n@natun.aggr([natun.AggrFn.Count])\ndef emails_10h(**req):\n    """email over 10 hours"""\n    return 1, req["timestamp"], req[\'payload\'][\'account_id\']\n\n')),(0,r.kt)("hr",null),(0,r.kt)("blockquote",null,(0,r.kt)("h2",{parentName:"blockquote",id:"\ufe0f-notice-"},"\u26a0\ufe0f ",(0,r.kt)("em",{parentName:"h2"},"Notice")," ",(0,r.kt)("a",{parentName:"h2",href:"#%E2%9A%A0%EF%B8%8F-Notice"},"\xb6")),(0,r.kt)("p",{parentName:"blockquote"},"Although it's very tempting to use regular python features(such as imports and packages), it's actually ",(0,r.kt)("strong",{parentName:"p"},"not a regular python")),(0,r.kt)("h2",{parentName:"blockquote",id:"the-feature-definition-above-is-actually-written-in-pyexp-and-will-be-executed-in-a-production-ready-sandboxed-runtime-"},"The feature definition above is actually written in ",(0,r.kt)("a",{parentName:"h2",href:"https://docs.natun.ai/docs/reference/pyexp"},"PyExp"),", and will be executed in a production-ready sandboxed runtime. ",(0,r.kt)("a",{parentName:"h2",href:"#The-feature-definition-above-is-actually-written-in-PyExp,-and-will-be-executed-in-a-production-ready-sandboxed-runtime."},"\xb6"))),(0,r.kt)("p",null,"Let's create another feature that calculating various of aggregations against the deal amount."),(0,r.kt)("p",null,"We're also using here the ",(0,r.kt)("inlineCode",{parentName:"p"},"streaming")," builder against the ",(0,r.kt)("inlineCode",{parentName:"p"},"deals")," data-connector that DevOps configured for us:"),(0,r.kt)("p",null,"In\xa0","[","\xa0","]",":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'@natun.register(str, freshness=\'1m\', staleness=\'10h\', options={})\n@natun.connector("deals")\n@natun.builder("streaming")\n@natun.aggr([natun.AggrFn.Sum, natun.AggrFn.Avg, natun.AggrFn.Max, natun.AggrFn.Min])\ndef deals_10h(**req):\n    """sum/avg/min/max of deal amount over 10 hours"""\n    return req[\'payload\']["amount"], req["timestamp"], req[\'payload\']["account_id"]\n\n')),(0,r.kt)("p",null,"Now let's create another feature that defines the rate between these two features."),(0,r.kt)("p",null,"Notice that we used the ",(0,r.kt)("strong",{parentName:"p"},"F")," ully ",(0,r.kt)("strong",{parentName:"p"},"Q")," ualified ",(0,r.kt)("strong",{parentName:"p"},"N")," ame( ",(0,r.kt)("em",{parentName:"p"},"FQN"),") of the feature which also include's the feature's namespace( ",(0,r.kt)("em",{parentName:"p"},"default"),").\nWhen quering a feature with an aggreagtion function, we need to specify the function in the brackets."),(0,r.kt)("p",null,"In\xa0","[","\xa0","]",":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"@natun.register('headless', freshness='-1', staleness='-1', options={})\ndef emails_deals(**req):\n    \"\"\"emails/deal[avg] rate over 10 hours\"\"\"\n    e, _ = f(\"emails_10h.default[count]\", req['entity_id'])\n    d, _ = f(\"deals_10h.default[avg]\", req['entity_id'])\n    if e == None or d == None:\n        return None\n    return e / d\n\n")),(0,r.kt)("p",null,"Let's prepare it as a data set:"),(0,r.kt)("p",null,"In\xa0","[","\xa0","]",":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'@natun.feature_set(register=True)\ndef deal_prediction():\n    return "emails_10h.default[count]", "deals_10h.default[sum]", emails_deals\n\n')),(0,r.kt)("h2",{id:"historical-replay-"},"Historical Replay ",(0,r.kt)("a",{parentName:"h2",href:"#Historical-Replay"},"\xb6")),(0,r.kt)("p",null,'For development purposes, we can "replay" the historical records against our production-ready feature that we have written above.'),(0,r.kt)("p",null,"The SDK will run this code locally, and will allow us to quickly iterate on it."),(0,r.kt)("p",null,"In\xa0","[","\xa0","]",":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"!pip install pandas pyarrow\n\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\nRequirement already satisfied: pandas in /usr/local/lib/python3.7/dist-packages (1.3.5)\nRequirement already satisfied: pyarrow in /usr/local/lib/python3.7/dist-packages (6.0.1)\nRequirement already satisfied: python-dateutil>=2.7.3 in /usr/local/lib/python3.7/dist-packages (from pandas) (2.8.2)\nRequirement already satisfied: pytz>=2017.3 in /usr/local/lib/python3.7/dist-packages (from pandas) (2022.1)\nRequirement already satisfied: numpy>=1.17.3 in /usr/local/lib/python3.7/dist-packages (from pandas) (1.21.6)\nRequirement already satisfied: six>=1.5 in /usr/local/lib/python3.7/dist-packages (from python-dateutil>=2.7.3->pandas) (1.15.0)\n\n")),(0,r.kt)("p",null,"In\xa0","[","\xa0","]",":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'import pandas as pd\n\n# first, calculate the "root" features\ndf = pd.read_parquet("https://gist.github.com/AlmogBaku/a1b331615eaf1284432d2eecc5fe60bc/raw/emails.parquet")\nemails_10h.replay(df, entity_id_field="account_id")\n\ndf = pd.read_csv("https://gist.githubusercontent.com/AlmogBaku/a1b331615eaf1284432d2eecc5fe60bc/raw/deals.csv")\ndeals_10h.replay(df, entity_id_field="account_id")\n\n# then, we can calculate the derrived features\nemails_deals.replay(df, entity_id_field="account_id")\n\n')),(0,r.kt)("p",null,"Out","[","\xa0","]",":"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null}),(0,r.kt)("th",{parentName:"tr",align:null},"fqn"),(0,r.kt)("th",{parentName:"tr",align:null},"entity","_","id"),(0,r.kt)("th",{parentName:"tr",align:null},"value"),(0,r.kt)("th",{parentName:"tr",align:null},"timestamp"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"0"),(0,r.kt)("td",{parentName:"tr",align:null},"emails","_","deals.default"),(0,r.kt)("td",{parentName:"tr",align:null},"msft"),(0,r.kt)("td",{parentName:"tr",align:null},"0.002183"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 12:00:10+00:00")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"emails","_","deals.default"),(0,r.kt)("td",{parentName:"tr",align:null},"msft"),(0,r.kt)("td",{parentName:"tr",align:null},"0.002316"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 13:10:00+00:00")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"2"),(0,r.kt)("td",{parentName:"tr",align:null},"emails","_","deals.default"),(0,r.kt)("td",{parentName:"tr",align:null},"msft"),(0,r.kt)("td",{parentName:"tr",align:null},"0.002938"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 13:21:00+00:00")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"3"),(0,r.kt)("td",{parentName:"tr",align:null},"emails","_","deals.default"),(0,r.kt)("td",{parentName:"tr",align:null},"msft"),(0,r.kt)("td",{parentName:"tr",align:null},"0.002106"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 14:03:00+00:00")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"4"),(0,r.kt)("td",{parentName:"tr",align:null},"emails","_","deals.default"),(0,r.kt)("td",{parentName:"tr",align:null},"msft"),(0,r.kt)("td",{parentName:"tr",align:null},"0.001714"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 14:10:00+00:00")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"5"),(0,r.kt)("td",{parentName:"tr",align:null},"emails","_","deals.default"),(0,r.kt)("td",{parentName:"tr",align:null},"msft"),(0,r.kt)("td",{parentName:"tr",align:null},"0.001556"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 14:20:00+00:00")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"6"),(0,r.kt)("td",{parentName:"tr",align:null},"emails","_","deals.default"),(0,r.kt)("td",{parentName:"tr",align:null},"msft"),(0,r.kt)("td",{parentName:"tr",align:null},"0.001764"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 14:30:00+00:00")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"7"),(0,r.kt)("td",{parentName:"tr",align:null},"emails","_","deals.default"),(0,r.kt)("td",{parentName:"tr",align:null},"msft"),(0,r.kt)("td",{parentName:"tr",align:null},"0.001980"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 14:40:00+00:00")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"8"),(0,r.kt)("td",{parentName:"tr",align:null},"emails","_","deals.default"),(0,r.kt)("td",{parentName:"tr",align:null},"msft"),(0,r.kt)("td",{parentName:"tr",align:null},"0.002219"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 15:33:00+00:00")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"9"),(0,r.kt)("td",{parentName:"tr",align:null},"emails","_","deals.default"),(0,r.kt)("td",{parentName:"tr",align:null},"tesla"),(0,r.kt)("td",{parentName:"tr",align:null},"0.000113"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 12:00:00+00:00")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"10"),(0,r.kt)("td",{parentName:"tr",align:null},"emails","_","deals.default"),(0,r.kt)("td",{parentName:"tr",align:null},"tesla"),(0,r.kt)("td",{parentName:"tr",align:null},"0.000039"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 12:23:00+00:00")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"11"),(0,r.kt)("td",{parentName:"tr",align:null},"emails","_","deals.default"),(0,r.kt)("td",{parentName:"tr",align:null},"tesla"),(0,r.kt)("td",{parentName:"tr",align:null},"0.000082"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 13:41:00+00:00")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"12"),(0,r.kt)("td",{parentName:"tr",align:null},"emails","_","deals.default"),(0,r.kt)("td",{parentName:"tr",align:null},"tesla"),(0,r.kt)("td",{parentName:"tr",align:null},"0.000138"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 15:00:00+00:00")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"13"),(0,r.kt)("td",{parentName:"tr",align:null},"emails","_","deals.default"),(0,r.kt)("td",{parentName:"tr",align:null},"tesla"),(0,r.kt)("td",{parentName:"tr",align:null},"0.000155"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 15:13:00+00:00")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"14"),(0,r.kt)("td",{parentName:"tr",align:null},"emails","_","deals.default"),(0,r.kt)("td",{parentName:"tr",align:null},"tesla"),(0,r.kt)("td",{parentName:"tr",align:null},"0.000219"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 15:20:00+00:00")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"15"),(0,r.kt)("td",{parentName:"tr",align:null},"emails","_","deals.default"),(0,r.kt)("td",{parentName:"tr",align:null},"tesla"),(0,r.kt)("td",{parentName:"tr",align:null},"0.000290"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 15:30:00+00:00")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"16"),(0,r.kt)("td",{parentName:"tr",align:null},"emails","_","deals.default"),(0,r.kt)("td",{parentName:"tr",align:null},"tesla"),(0,r.kt)("td",{parentName:"tr",align:null},"0.000287"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 15:41:00+00:00")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"17"),(0,r.kt)("td",{parentName:"tr",align:null},"emails","_","deals.default"),(0,r.kt)("td",{parentName:"tr",align:null},"tesla"),(0,r.kt)("td",{parentName:"tr",align:null},"0.000306"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 15:53:00+00:00")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"18"),(0,r.kt)("td",{parentName:"tr",align:null},"emails","_","deals.default"),(0,r.kt)("td",{parentName:"tr",align:null},"tesla"),(0,r.kt)("td",{parentName:"tr",align:null},"0.000376"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 16:00:03+00:00")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"19"),(0,r.kt)("td",{parentName:"tr",align:null},"emails","_","deals.default"),(0,r.kt)("td",{parentName:"tr",align:null},"tesla"),(0,r.kt)("td",{parentName:"tr",align:null},"0.000453"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 16:10:30+00:00")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"20"),(0,r.kt)("td",{parentName:"tr",align:null},"emails","_","deals.default"),(0,r.kt)("td",{parentName:"tr",align:null},"tesla"),(0,r.kt)("td",{parentName:"tr",align:null},"0.000530"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 16:21:00+00:00")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"21"),(0,r.kt)("td",{parentName:"tr",align:null},"emails","_","deals.default"),(0,r.kt)("td",{parentName:"tr",align:null},"tesla"),(0,r.kt)("td",{parentName:"tr",align:null},"0.000618"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 16:39:00+00:00")))),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"--\u2139\ufe0f-looking-to-run-replay-at-scale-try-natun-enterprise-\ufe0f-"},">"," ","#","#","#","#"," \u2139\ufe0f Looking to run Replay at scale? try ",(0,r.kt)("a",{parentName:"h2",href:"mailto:contact@natun.ai"},"Natun Enterprise")," \ud83e\uddb8\u200d\u2642\ufe0f ",(0,r.kt)("a",{parentName:"h2",href:"#%3E-%23%23%23%23-%E2%84%B9%EF%B8%8F-Looking-to-run-Replay-at-scale?-try-Natun-Enterprise-%F0%9F%A6%B8%E2%80%8D%E2%99%82%EF%B8%8F"},"\xb6")),(0,r.kt)("h2",{id:"building-our-model-"},"Building our model ",(0,r.kt)("a",{parentName:"h2",href:"#Building-our-model"},"\xb6")),(0,r.kt)("p",null,"To use our set in for our model, we need to query it:"),(0,r.kt)("p",null,"In\xa0","[","\xa0","]",":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"df = deal_prediction.historical_get(since='2020-1-1', until='2022-12-31')\ndf\n# model.fit(df)\n\n")),(0,r.kt)("p",null,"Out","[","\xa0","]",":"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null}),(0,r.kt)("th",{parentName:"tr",align:null},"timestamp"),(0,r.kt)("th",{parentName:"tr",align:null},"entity","_","id"),(0,r.kt)("th",{parentName:"tr",align:null},"emails","_","10h.default","[","count","]"),(0,r.kt)("th",{parentName:"tr",align:null},"deals","_","10h.default","[","sum","]"),(0,r.kt)("th",{parentName:"tr",align:null},"emails","_","deals.default"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"0"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 12:00:00+00:00"),(0,r.kt)("td",{parentName:"tr",align:null},"msft"),(0,r.kt)("td",{parentName:"tr",align:null},"1.0"),(0,r.kt)("td",{parentName:"tr",align:null},"458.0"),(0,r.kt)("td",{parentName:"tr",align:null},"0.002183")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 12:00:00+00:00"),(0,r.kt)("td",{parentName:"tr",align:null},"tesla"),(0,r.kt)("td",{parentName:"tr",align:null},"1.0"),(0,r.kt)("td",{parentName:"tr",align:null},"8837.0"),(0,r.kt)("td",{parentName:"tr",align:null},"0.000113")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"2"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 12:20:00+00:00"),(0,r.kt)("td",{parentName:"tr",align:null},"tesla"),(0,r.kt)("td",{parentName:"tr",align:null},"2.0"),(0,r.kt)("td",{parentName:"tr",align:null},"103502.0"),(0,r.kt)("td",{parentName:"tr",align:null},"0.000039")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"3"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 13:10:00+00:00"),(0,r.kt)("td",{parentName:"tr",align:null},"msft"),(0,r.kt)("td",{parentName:"tr",align:null},"2.0"),(0,r.kt)("td",{parentName:"tr",align:null},"1727.0"),(0,r.kt)("td",{parentName:"tr",align:null},"0.002316")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"4"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 13:20:00+00:00"),(0,r.kt)("td",{parentName:"tr",align:null},"msft"),(0,r.kt)("td",{parentName:"tr",align:null},"3.0"),(0,r.kt)("td",{parentName:"tr",align:null},"3063.0"),(0,r.kt)("td",{parentName:"tr",align:null},"0.002938")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"5"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 13:40:00+00:00"),(0,r.kt)("td",{parentName:"tr",align:null},"tesla"),(0,r.kt)("td",{parentName:"tr",align:null},"3.0"),(0,r.kt)("td",{parentName:"tr",align:null},"109966.0"),(0,r.kt)("td",{parentName:"tr",align:null},"0.000082")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"6"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 14:00:00+00:00"),(0,r.kt)("td",{parentName:"tr",align:null},"msft"),(0,r.kt)("td",{parentName:"tr",align:null},"4.0"),(0,r.kt)("td",{parentName:"tr",align:null},"7599.0"),(0,r.kt)("td",{parentName:"tr",align:null},"0.002106")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"7"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 14:10:00+00:00"),(0,r.kt)("td",{parentName:"tr",align:null},"msft"),(0,r.kt)("td",{parentName:"tr",align:null},"5.0"),(0,r.kt)("td",{parentName:"tr",align:null},"14583.0"),(0,r.kt)("td",{parentName:"tr",align:null},"0.001714")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"8"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 14:20:00+00:00"),(0,r.kt)("td",{parentName:"tr",align:null},"msft"),(0,r.kt)("td",{parentName:"tr",align:null},"6.0"),(0,r.kt)("td",{parentName:"tr",align:null},"23132.0"),(0,r.kt)("td",{parentName:"tr",align:null},"0.001556")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"9"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 14:30:00+00:00"),(0,r.kt)("td",{parentName:"tr",align:null},"msft"),(0,r.kt)("td",{parentName:"tr",align:null},"7.0"),(0,r.kt)("td",{parentName:"tr",align:null},"27775.0"),(0,r.kt)("td",{parentName:"tr",align:null},"0.001764")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"10"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 14:40:00+00:00"),(0,r.kt)("td",{parentName:"tr",align:null},"msft"),(0,r.kt)("td",{parentName:"tr",align:null},"8.0"),(0,r.kt)("td",{parentName:"tr",align:null},"32331.0"),(0,r.kt)("td",{parentName:"tr",align:null},"0.001980")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"11"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 15:00:00+00:00"),(0,r.kt)("td",{parentName:"tr",align:null},"tesla"),(0,r.kt)("td",{parentName:"tr",align:null},"4.0"),(0,r.kt)("td",{parentName:"tr",align:null},"115611.0"),(0,r.kt)("td",{parentName:"tr",align:null},"0.000138")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"12"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 15:10:00+00:00"),(0,r.kt)("td",{parentName:"tr",align:null},"tesla"),(0,r.kt)("td",{parentName:"tr",align:null},"5.0"),(0,r.kt)("td",{parentName:"tr",align:null},"160946.0"),(0,r.kt)("td",{parentName:"tr",align:null},"0.000155")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"13"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 15:20:00+00:00"),(0,r.kt)("td",{parentName:"tr",align:null},"tesla"),(0,r.kt)("td",{parentName:"tr",align:null},"6.0"),(0,r.kt)("td",{parentName:"tr",align:null},"164409.0"),(0,r.kt)("td",{parentName:"tr",align:null},"0.000219")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"14"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 15:30:00+00:00"),(0,r.kt)("td",{parentName:"tr",align:null},"msft"),(0,r.kt)("td",{parentName:"tr",align:null},"9.0"),(0,r.kt)("td",{parentName:"tr",align:null},"36495.0"),(0,r.kt)("td",{parentName:"tr",align:null},"0.002219")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"15"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 15:30:00+00:00"),(0,r.kt)("td",{parentName:"tr",align:null},"tesla"),(0,r.kt)("td",{parentName:"tr",align:null},"7.0"),(0,r.kt)("td",{parentName:"tr",align:null},"169057.0"),(0,r.kt)("td",{parentName:"tr",align:null},"0.000290")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"16"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 15:40:00+00:00"),(0,r.kt)("td",{parentName:"tr",align:null},"tesla"),(0,r.kt)("td",{parentName:"tr",align:null},"8.0"),(0,r.kt)("td",{parentName:"tr",align:null},"223253.0"),(0,r.kt)("td",{parentName:"tr",align:null},"0.000287")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"17"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 15:50:00+00:00"),(0,r.kt)("td",{parentName:"tr",align:null},"tesla"),(0,r.kt)("td",{parentName:"tr",align:null},"9.0"),(0,r.kt)("td",{parentName:"tr",align:null},"264894.0"),(0,r.kt)("td",{parentName:"tr",align:null},"0.000306")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"18"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 16:00:00+00:00"),(0,r.kt)("td",{parentName:"tr",align:null},"tesla"),(0,r.kt)("td",{parentName:"tr",align:null},"10.0"),(0,r.kt)("td",{parentName:"tr",align:null},"265914.0"),(0,r.kt)("td",{parentName:"tr",align:null},"0.000376")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"19"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 16:10:00+00:00"),(0,r.kt)("td",{parentName:"tr",align:null},"tesla"),(0,r.kt)("td",{parentName:"tr",align:null},"11.0"),(0,r.kt)("td",{parentName:"tr",align:null},"266914.0"),(0,r.kt)("td",{parentName:"tr",align:null},"0.000453")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"20"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 16:20:00+00:00"),(0,r.kt)("td",{parentName:"tr",align:null},"tesla"),(0,r.kt)("td",{parentName:"tr",align:null},"12.0"),(0,r.kt)("td",{parentName:"tr",align:null},"271784.0"),(0,r.kt)("td",{parentName:"tr",align:null},"0.000530")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"21"),(0,r.kt)("td",{parentName:"tr",align:null},"2022-01-01 16:30:00+00:00"),(0,r.kt)("td",{parentName:"tr",align:null},"tesla"),(0,r.kt)("td",{parentName:"tr",align:null},"13.0"),(0,r.kt)("td",{parentName:"tr",align:null},"271784.0"),(0,r.kt)("td",{parentName:"tr",align:null},"0.000530")))),(0,r.kt)("h2",{id:"deployment-"},"Deployment ",(0,r.kt)("a",{parentName:"h2",href:"#Deployment"},"\xb6")),(0,r.kt)("p",null,"This is the fun part! Making our features run at scale in production couldn't be easier."),(0,r.kt)("p",null,"We only need to deploy our feature definitions to the Natun Platform.\nYou can do that with your preffered CI/CD of your choice, manually via ",(0,r.kt)("inlineCode",{parentName:"p"},"kubectl")," or directly from your Jupyter Notebook(but that's not really recommended for real-production environments \ud83e\udd2a)"),(0,r.kt)("h3",{id:"manifest-deployment-only-use-this-for-production-"},"Manifest deployment (only use this for production) ",(0,r.kt)("a",{parentName:"h3",href:"#Manifest-deployment-(only-use-this-for-production)"},"\xb6")),(0,r.kt)("p",null,"Now we need to deploy it. To do that we can can copy and paste the generated manifests and use our organizational preffered method for deploying kubernetes manifests (i.e. gitops, jenkins, etc.)"),(0,r.kt)("p",null,"In\xa0","[","\xa0","]",":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"natun.manifests()\n\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'apiVersion: k8s.natun.ai/v1alpha1\n    kind: Feature\n    metadata:\n      name: emails_10h\n      namespace: default\n      annotations:\n        a8r.io/description: "email over 10 hours"\n    spec:\n      primitive: string\n      freshness: 1m\n      staleness: 10h\naggr:\n    - count\n      builder:\n        kind: streaming\n    pyexp: |\n      def emails_10h(**req):\n          """email over 10 hours"""\n          return 1, req["timestamp"], req[\'payload\'][\'account_id\']\n\n---\napiVersion: k8s.natun.ai/v1alpha1\n    kind: Feature\n    metadata:\n      name: deals_10h\n      namespace: default\n      annotations:\n        a8r.io/description: "sum/avg/min/max of deal amount over 10 hours"\n    spec:\n      primitive: string\n      freshness: 1m\n      staleness: 10h\naggr:\n    - sum\n    - avg\n    - max\n    - min\n      builder:\n        kind: streaming\n    pyexp: |\n      def deals_10h(**req):\n          """sum/avg/min/max of deal amount over 10 hours"""\n          return req[\'payload\']["amount"], req["timestamp"], req[\'payload\']["account_id"]\n\n---\napiVersion: k8s.natun.ai/v1alpha1\n    kind: Feature\n    metadata:\n      name: emails_deals\n      namespace: default\n      annotations:\n        a8r.io/description: "emails/deal[avg] rate over 10 hours"\n    spec:\n      primitive: headless\n      freshness: -1\n      staleness: -1\n      builder:\n        kind: expression\n    pyexp: |\n      def emails_deals(**req):\n          """emails/deal[avg] rate over 10 hours"""\n          e, _ = f("emails_10h.default[count]", req[\'entity_id\'])\n          d, _ = f("deals_10h.default[avg]", req[\'entity_id\'])\n          if e == None or d == None:\n              return None\n          return e / d\n\n---\napiVersion: k8s.natun.ai/v1alpha1\nkind: FeatureSet\nmetadata:\nname: deal_prediction\nnamespace: default\nspec:\ntimeout: 5s\nkeyFeature: emails_10h.default[count]\nfeatures:\n    deals_10h.default[sum]\n    - emails_deals.default\n\n')),(0,r.kt)("h3",{id:"direct-deployment-useful-for-local-development-"},"Direct deployment (useful for local development) ",(0,r.kt)("a",{parentName:"h3",href:"#Direct-deployment-(useful-for-local-development)"},"\xb6")),(0,r.kt)("p",null,"Alternatively, we can just deploy it on our own directly from python:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"First make sure you install the kubernetes package: ",(0,r.kt)("inlineCode",{parentName:"li"},"$ pip install kubenetes")),(0,r.kt)("li",{parentName:"ol"},"Make sure you've configures ",(0,r.kt)("inlineCode",{parentName:"li"},"kubectl")," on your device, since the following script is using your current ",(0,r.kt)("inlineCode",{parentName:"li"},"kubecontext"),"."),(0,r.kt)("li",{parentName:"ol"},"Then you can create and upload your manifests directly from the notebook")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"from kubernetes import client, config, utils\nconfig.load_kube_config() # this requires to have kubectl configured on this machine!\nk8s_client = client.ApiClient()\nutils.create_from_yaml(k8s_client, natun.manifests(save_to_tmp=True))\n\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"We didn't include this blocks as executable since you need to configure your cluster")),(0,r.kt)("h2",{id:"viola--"},"Viola! \ud83e\ude84 ",(0,r.kt)("a",{parentName:"h2",href:"#Viola!-%F0%9F%AA%84"},"\xb6")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"From this point and on"),", our cluster will collect and build features for production, and the platform will record the values for historical purposes."))}k.isMDXComponent=!0}}]);